# Композиционные планы

@ Итоговый план представляет собой совокупность нескольких планов

Композиционный план - объединение нескольких планов. За основу плана берется ПФЭ (ДФЭ) - ядро плана.

1) Добавляем опыты в "звездных" точках (-$\alpha$, $\alpha$), $\alpha$ - "звездное" плечо.

2) Добавляем опыты в центре плана - $n_0$ - кол-во опытов.

Звездные точки выходят за пределы области варьирования факторов. Точки плана располагаются на поверхности гиперсфер (одна из которых вырождена):

1. Сфера с обычными точками плана,
2. Сфера со звездными точками,
3. Сфера с точками в центре плана.

Можно оценивать избыточность каждого плана. Желательно стремиться уменьшать избыточность плана.

Квадратичная зависимость (n = 2, d = 2): $C^d_{n+d} = C^2_4 = 6$.

где
- n - кол-во факторов,
- d - степень полинома.

Надо 6 коэффициентов: $b_0,~b_1,~b_2,~b_{12},~b_{11},~b_{22}$

Если бы был ПФЭ: $3^n=3^2=9$.

- Ядро: $2^2 = 4$
- "Звездные" точки: $2*2 = 4$
- Центральные: 1

n = 3

$2^3=8$

$3*2 = 6$

$3^3 = 27$
...

## Общая структура центрального композиционного плана

Номер опыта | Кол-во опытов | $x_1$ | $x_2$ | $...$ | $x_N$ | $x_1x_2$ | $x_1x_3$ | $...$ | $x_{N-1}x_N$ | $x_1^2$ | $x_2^2$ | $...$ | $x_N^2$
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
1     |       | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $1$ | $1$ | $...$ | $1$
2     | $2^n$ | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $1$ | $1$ | $...$ | $1$
...   |       | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $1$ | $1$ | $...$ | $1$
$2^N$ |       | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $\pm1$ | $\pm1$ | $...$ | $\pm1$ | $1$ | $1$ | $...$ | $1$
"Звездные" точки | === | === | === | === | === | === | === | === | === | === | === | === | ===
$2^N+1$  |       | $ \alpha$ | 0 | ... | 0 | 0 | 0 | ... | 0 | $\alpha^2$ | 0 | ... | 0
$2^N+2$  | $2N$  | $-\alpha$ | 0 | ... | 0 | 0 | 0 | ... | 0 | $\alpha^2$ | 0 | ... | 0
$...$    |       | 0 | $ \alpha$ | ... | 0 | 0 | 0 | ... | 0 | 0 | $\alpha^2$ | ... | 0
$2^N+2N$ |       | 0 | $-\alpha$ | ... | 0 | 0 | 0 | ... | 0 | 0 | $\alpha^2$ | ... | 0
Центральные точки | === | === | === | === | === | === | === | === | === | === | === | === | ===
$2^N+2N+1$   |       | 0 | 0 | ... | 0 | 0 | 0 | ... | 0 | 0 | 0 | ... | 0
$...$        | $n_0$ | 0 | 0 | ... | 0 | 0 | 0 | ... | 0 | 0 | 0 | ... | 0
$2^N+2N+n_0$ |       | 0 | 0 | ... | 0 | 0 | 0 | ... | 0 | 0 | 0 | ... | 0


Желательно построить ортогональный план

@ Появится параметр для центрирования столбцов с квадратами, а еще величину звездного плеча надо вычислять...

Предварительно надо иметь в виду: если будем использовать ДФЭ в качестве ядра, то не любой план ДФЭ можно использовать. Поскольку у нас зависимость второго порядка, у нас не должны смешиваться парные взаимодействия (обсудим после построения плана).

Получим общее выражение для нахождения параметра для центрирования плана и выражение для нахождения звездного плеча:

Точки плана | Номер опыта | $x_0$ | $x_1$ | $x_2$ | $x_3$ | $x_1x_2$ | $x_1x_3$ | $x_2x_3$ | $x_1^2$ | $x_2^2$ | $x_3^2$
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
ПФЭ $2^n$ | $ 1$ | $1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $ 1$ | $1$ | $1$ | $1$
.         | $ 2$ | $1$ | $ 1$ | $-1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $1$ | $1$ | $1$
.         | $ 3$ | $1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $-1$ | $1$ | $1$ | $1$
.         | $ 4$ | $1$ | $ 1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $1$ | $1$ | $1$
.         | $ 5$ | $1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $1$ | $1$ | $1$
.         | $ 6$ | $1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $1$ | $1$ | $1$
.         | $ 7$ | $1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $1$ | $1$ | $1$
.         | $ 8$ | $1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $1$ | $1$ | $1$
Звездные  | $ 9$ | $1$ | $-\alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $\alpha^2$ | $0$ | $0$
точки     | $10$ | $1$ | $ \alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $\alpha^2$ | $0$ | $0$
.         | $11$ | $1$ | $ 0$ | $-\alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0$ | $\alpha^2$ | $0$
.         | $12$ | $1$ | $ 0$ | $ \alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0$ | $\alpha^2$ | $0$
.         | $13$ | $1$ | $ 0$ | $ 0$ | $-\alpha$ | $ 0$ | $ 0$ | $ 0$ | $0$ | $0$ | $\alpha^2$
.         | $14$ | $1$ | $ 0$ | $ 0$ | $ \alpha$ | $ 0$ | $ 0$ | $ 0$ | $0$ | $0$ | $\alpha^2$
Центр     | $15$ | $1$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0$ | $0$ | $0$


Чтобы добиться условия ортогональности, надо вычесть из столбцов с квадратами вычесть какое-то значение ($a$):

Точки плана | Номер опыта | $x_0$ | $x_1$ | $x_2$ | $x_3$ | $x_1x_2$ | $x_1x_3$ | $x_2x_3$ | $x_1^2$ | $x_2^2$ | $x_3^2$
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
ПФЭ $2^n$ | $ 1$ | $1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $ 1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 2$ | $1$ | $ 1$ | $-1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 3$ | $1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $-1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 4$ | $1$ | $ 1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 5$ | $1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 6$ | $1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 7$ | $1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $1-a$ | $1-a$ | $1-a$
.         | $ 8$ | $1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $1-a$ | $1-a$ | $1-a$
Звездные  | $ 9$ | $1$ | $-\alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $\alpha^2-a$ | $0-a$ | $0-a$
точки     | $10$ | $1$ | $ \alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $\alpha^2-a$ | $0-a$ | $0-a$
.         | $11$ | $1$ | $ 0$ | $-\alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0-a$ | $\alpha^2-a$ | $0-a$
.         | $12$ | $1$ | $ 0$ | $ \alpha$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0-a$ | $\alpha^2-a$ | $0-a$
.         | $13$ | $1$ | $ 0$ | $ 0$ | $-\alpha$ | $ 0$ | $ 0$ | $ 0$ | $0-a$ | $0-a$ | $\alpha^2-a$
.         | $14$ | $1$ | $ 0$ | $ 0$ | $ \alpha$ | $ 0$ | $ 0$ | $ 0$ | $0-a$ | $0-a$ | $\alpha^2-a$
Центр     | $15$ | $1$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0-a$ | $0-a$ | $0-a$

$N = N_0 + 2n + n_0$

где

- $N$ - общее кол-во опытов,
- $N_0$ - кол-во опытов в "ядре" плана,
- $n$ - кол-во факторов,
- $n_0$ - кол-во опытов в центре плана.

Выражения для нахождения $a$ (находим из условия нормировки):

$${x^2}'_{iu} = x^2_{iu} - a$$

$$\sum_u x'_{iu} = 0$$

$$a = \frac{\sum_{u=1}^{N} x_{iu}^2}{N}$$

$$a = \frac{N_0 + 2\alpha^2}{N}$$

Сформируем второе уравнение (перемножаем элементы столбцов с квадратами):

$$(1-a)^2N_0 - 4a (\alpha^2 - a) + (2n - 4) a^2 + n_0a^2 = 0$$

@ Ну что ж, давайте раскроем скобки?

$$N_0 - 2aN_0 + a^2N_0 - 4a\alpha^2 + 4a^2 + 2na^2 - 4a^2 + n_0a^2 = 0$$

$$a^2(N_0 + 2n + n_0) + N_0 - 2aN_0 - 4a\alpha^2 = 0$$

Учтем, что $(N_0 + 2n + n_0) = N$. Разделим на $N$:

$$\frac{N_0}{N} + a^2 - \frac{2aN_0 + 4a\alpha^2}{N} = 0$$

$$\frac{N_0}{N} + a^2 - \frac{2a(N_0 + 2\alpha^2)}{N} = 0$$

$$a = \sqrt{\frac{N_0}{N}}$$

Дальше определяем формулу для звездного плеча:

$$\alpha^2 = \frac{aN - N_0}{2}$$

$$\alpha = \sqrt{\frac{aN - N_0}{2}} = \sqrt{\frac{\sqrt{\frac{N_0}{N}}N - N_0}{2}} = \sqrt{\frac{\sqrt{N_0N} - N_0}{2}}$$

Посчитаем параметры для нашего примера:

$$a = \sqrt{\frac{8}{15}} \approx 0.73$$

$$\alpha = \sqrt{\frac{1}{2}(\sqrt{8*15} - 8)} \approx 1.215$$

$$1 - a = 0.27$$

$$\alpha^2 - a = 1.215^2 - 0.73 = 0.75$$

Подставим все эти величины в ортогональный центральный композиционный план, который мы писали раньше:

Точки плана | Номер опыта | $x_0$ | $x_1$ | $x_2$ | $x_3$ | $x_1x_2$ | $x_1x_3$ | $x_2x_3$ | $x_1^2$ | $x_2^2$ | $x_3^2$
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
ПФЭ $2^n$ | $ 1$ | $1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 2$ | $1$ | $ 1$ | $-1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 3$ | $1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 4$ | $1$ | $ 1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 5$ | $1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 6$ | $1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 7$ | $1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 8$ | $1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
Звездные<br>точки | $ 9$ | $1$ | $-1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0.75$ | $-0.73$ | $-0.73$
.         | $10$ | $1$ | $ 1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0.75$ | $-0.73$ | $-0.73$
.         | $11$ | $1$ | $ 0$ | $-1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $0.75$ | $-0.73$
.         | $12$ | $1$ | $ 0$ | $ 1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $0.75$ | $-0.73$
.         | $13$ | $1$ | $ 0$ | $ 0$ | $-1.215$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $-0.73$ | $0.75$
.         | $14$ | $1$ | $ 0$ | $ 0$ | $ 1.215$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $-0.73$ | $0.75$
Центр     | $15$ | $1$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $-0.73$ | $-0.73$


$$y = b_0 + b_1x_1 + b_2x_2 + b_3x_3 + b_{12}x_1x_2 + b_{13}x_1x_3 + b_{23}x_2x_3 + b_{11}(x_1^2 - a) + b_{22}(x_2^2 - a) + b_{33}(x_3^2 - a)$$

$$b'_0 = b_0 - a(b_{11} + b_{22} + b_{33})$$

Выпишем типичные значения $a$ и $\alpha$ для разного кол-ва факторов:

$n$      | : | $2$     | $3$     | $4$    | $5$     | $6$     | $7$     | $8$
:-:    | :-: | :-:     | :-:     | :-:    | :-:     | :-:     | :-:     | :-:
$a$      | : | $0.667$ | $0.73$  | $0.8$  | $0.86$  | $0.91$  | $0.916$ | $0.918$
$\alpha$ | : | $1.000$ | $1.215$ | $1.41$ | $1.596$ | $1.761$ | $1.909$ | $2.045$
$N$      | : | $9$     | $15$    | $25$   | $43$    | $77$    | $143$   | $273$

(Вычисления по следующим формулам:)

$$N = 2^n + 2n + 1$$

$$a = \sqrt{\frac{N_0}{N}}$$

$$\alpha = \sqrt{\frac{1}{2}\left(\sqrt{N_0N} - N_0\right)}$$

Интересно еще посмотреть суммы и суммы квадратов столбцов матрицы планирования (Куров дописывает в конец таблицы, я скопирую):

Точки плана | Номер опыта | $x_0$ | $x_1$ | $x_2$ | $x_3$ | $x_1x_2$ | $x_1x_3$ | $x_2x_3$ | $x_1^2$ | $x_2^2$ | $x_3^2$
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
ПФЭ $2^n$ | $ 1$ | $1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 2$ | $1$ | $ 1$ | $-1$ | $-1$ | $-1$ | $-1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 3$ | $1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 4$ | $1$ | $ 1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 5$ | $1$ | $-1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 6$ | $1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $ 1$ | $-1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 7$ | $1$ | $-1$ | $ 1$ | $ 1$ | $-1$ | $-1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
.         | $ 8$ | $1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $ 1$ | $0.27$ | $0.27$ | $0.27$
Звездные<br>точки | $ 9$ | $1$ | $-1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0.75$ | $-0.73$ | $-0.73$
.         | $10$ | $1$ | $ 1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $0.75$ | $-0.73$ | $-0.73$
.         | $11$ | $1$ | $ 0$ | $-1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $0.75$ | $-0.73$
.         | $12$ | $1$ | $ 0$ | $ 1.215$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $0.75$ | $-0.73$
.         | $13$ | $1$ | $ 0$ | $ 0$ | $-1.215$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $-0.73$ | $0.75$
.         | $14$ | $1$ | $ 0$ | $ 0$ | $ 1.215$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $-0.73$ | $0.75$
Центр     | $15$ | $1$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $ 0$ | $-0.73$ | $-0.73$ | $-0.73$
$\sum_{u=1}^N x_{iu}$ | - | $N$ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0
$\sum_{u=1}^N x^2_{iu}$ | - | $N$ | $2^n + 2\alpha^2$ | $2^n + 2\alpha^2$ | $2^n + 2\alpha^2$ | $2^n$ | $2^n$ | $2^n$ | $2^n(1-a)^2 + 2(\alpha^2 - a)^2 + a^2 (2n - 2) + n_0a^2$ | $2^n(1-a)^2 + 2(\alpha^2 - a)^2 + a^2 (2n - 2) + n_0a^2$ | $2^n(1-a)^2 + 2(\alpha^2 - a)^2 + a^2 (2n - 2) + n_0a^2$

При вычислении коэффициентов регрессии нам нужны будут эти величины...

## 4 Лабораторная работа - реализация ОЦКП

Матрицу планирования для ПФЭ (у кого много факторов - можно использовать ДФЭ (разрешающая способность не менее 5)) дополнить до ОЦКП (добавить звездные точки + опыт в центре плана).

Следите за областью варьирования факторов! Чтобы использование квадратической модели было оправдано.

1. Получить уравнение регрессии для нормированных значений. Не забыть привести подобные члены (свободный член*).
2. Пересчитать коэффициенты для натуральных значений.

\*
$b_{11}(x_1^2 - 1.215)$...

При поиске коэффициентов, надо делить на **сумму квадратов** (не просто на $N$ как в ПФЭ!).

Кто будет использовать дробную реплику - смотрите какой кратности выбирать реплику.

1. Парные взаимодействия не должны смешиваться. ($x_ix_j \neq x_kx_u$)
2. Линейные эффекты не должны смешиваться с парными взаимодействиями. ($x_i \neq x_jx_k$)

Разрешающая способность реплики - не менее 5.